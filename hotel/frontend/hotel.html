<!DOCTYPE html>
<html lang="de">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Jet3Holiday – Hotels</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.7/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
      body {
        background: linear-gradient(to right, #dbeafe, #e0f2fe);
        font-family: 'Segoe UI', sans-serif;
      }
  
      .navbar {
        background-color: #3b82f6;
      }
  
      .navbar-brand, .nav-link, .navbar-text {
        color: white !important;
        font-weight: 500;
      }
  
      .nav-link:hover {
        text-decoration: underline;
      }
  
      h1 {
        color: #1e40af;
        margin-top: 1.5rem;
      }
  
      #adminSection, #hotelsList {
        background-color: #ffffffd9;
        padding: 1.5rem;
        border-radius: 12px;
        box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
      }
  
      #addhotelForm {
        background-color: #f1f5f9;
        padding: 1rem;
        border-radius: 10px;
      }
  
      .btn-primary {
        background-color: #2563eb;
        border-color: #2563eb;
      }
  
      .btn-primary:hover {
        background-color: #1e40af;
        border-color: #1e40af;
      }
  
      .btn-success {
        background-color: #10b981;
        border-color: #10b981;
      }
  
      .btn-success:hover {
        background-color: #047857;
        border-color: #047857;
      }
  
      .btn-danger {
        background-color: #ef4444;
        border-color: #ef4444;
      }
  
      .btn-danger:hover {
        background-color: #b91c1c;
        border-color: #b91c1c;
      }
    </style>
  </head>
  <body>
      <!-- Navbar -->
  <nav class="navbar navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="/startseite.html">Jet3Holiday</a>
      <div class="collapse navbar-collapse">
        <ul class="navbar-nav me-auto">
          <li class="nav-item"><a class="nav-link" href="/flugverbindung/frontend/flugverbindung.html">Flugverbindung</a></li>
          <li class="nav-item"><a class="nav-link" href="/mietwagen/frontend/mietwagen.html">Mietwagen buchen</a></li>
          <li class="nav-item"><a class="nav-link" href="hotel.html">Hotel suchen</a></li>
          <li class="nav-item"><a class="nav-link" href="/bewertung/frontend/bewertung.html">Bewertungen</a></li>
        </ul>
        <span class="navbar-text" id="roleInfo"></span>
        <button id="logoutBtn" class="btn btn-danger btn-sm ms-3">Logout</button>
      </div>
    </div>
  </nav>
    <div class="container mt-4">
      <h1>Hotelangebote</h1>
      <p id="roleInfo"></p>
  
      <!-- Admin Bereich -->
      <div id="adminSection" style="display:none;">
        <button id="addHotelBtn" class="btn btn-success mb-3">Hotel anlegen (Admin)</button>
  
        <form id="addHotelForm" style="display:none;">
          <div class="mb-3">
            <label for="hotelName" class="form-label">Hotelname</label>
            <input type="text" class="form-control" id="hotelName" required>
          </div>
          <div class="mb-3">
            <label for="ort" class="form-label">Ort</label>
            <input type="text" class="form-control" id="ort" required>
          </div>
          <div class="mb-3">
            <label for="land" class="form-label">Land</label>
            <input type="text" class="form-control" id="land" required>
          </div>
          <div class="mb-3">
            <label for="preis" class="form-label">Preis (€)</label>
            <input type="number" class="form-control" id="preis" min="0" step="0.01" required>
          </div>
          <button type="submit" class="btn btn-primary">Hotel anlegen</button>
        </form>
        <div id="addHotelMsg" class="mt-2"></div>
      </div>
  
      <!-- Hotel Liste -->
      <div id="hotelsList" class="mt-4">
        <!-- Hotels werden hier angezeigt -->
      </div>
      </div>
  </body>
  

<script>
  document.addEventListener('DOMContentLoaded', () => {
    const token = localStorage.getItem('token');
    if (!token) {
      window.location.href = '/startseite.html';
      return;
    }

    const isAdmin = localStorage.getItem('isAdmin') === 'true';
    document.getElementById('roleInfo').textContent = isAdmin
      ? 'Du bist als Admin eingeloggt.'
      : 'Du bist als Benutzer eingeloggt.';

    if (isAdmin) {
      document.getElementById('adminSection').style.display = 'block';
    }

    document.getElementById('logoutBtn').addEventListener('click', () => {
      localStorage.removeItem('token');
      localStorage.removeItem('isAdmin');
      window.location.href = '/startseite.html';
    });

    document.getElementById('addHotelBtn').addEventListener('click', () => {
      const form = document.getElementById('addHotelForm');
      form.style.display = form.style.display === 'none' ? 'block' : 'none';
      document.getElementById('addHotelMsg').textContent = '';
    });

    document.getElementById('addHotelForm').addEventListener('submit', async (e) => {
      e.preventDefault();

      const hotelName = document.getElementById('hotelName').value.trim();
      const ort = document.getElementById('ort').value.trim();
      const land = document.getElementById('land').value.trim();
      const preis = parseFloat(document.getElementById('preis').value);

      if (!hotelName || !ort || !land || isNaN(preis)) {
        document.getElementById('addHotelMsg').textContent = 'Bitte alle Felder korrekt ausfüllen.';
        document.getElementById('addHotelMsg').style.color = 'red';
        return;
      }

      try {
        const response = await fetch('http://localhost:3000/', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Authorization': 'Bearer ' + token
          },
          body: JSON.stringify({ hotelName, ort, land, preis })
        });

        if (!response.ok) {
          const errorData = await response.json();
          throw new Error(errorData.message || 'Fehler beim Anlegen des Hotels');
        }

        document.getElementById('addHotelMsg').textContent = 'Hotel erfolgreich angelegt!';
        document.getElementById('addHotelMsg').style.color = 'green';
        document.getElementById('addHotelForm').reset();
        document.getElementById('addHotelForm').style.display = 'none';

        ladeHotels(token);
      } catch (err) {
        document.getElementById('addHotelMsg').textContent = err.message;
        document.getElementById('addHotelMsg').style.color = 'red';
        console.error(err);
      }
    });

    ladeHotels(token);
  });

  async function ladeHotels(token) {
    try {
      const res = await fetch('http://localhost:3000/', {
        headers: {
          'Authorization': 'Bearer ' + token
        }
      });
      if (!res.ok) throw new Error('Fehler beim Laden der Hotels');
      const hotels = await res.json();

      const hotelsList = document.getElementById('hotelsList');
      hotelsList.innerHTML = '';

      if (hotels.length === 0) {
        hotelsList.textContent = 'Keine Hotels vorhanden.';
        return;
      }

      const ul = document.createElement('ul');
      ul.classList.add('list-group');

      hotels.forEach(hotel => {
        const li = document.createElement('li');
        li.className = 'list-group-item';
        li.textContent = `${hotel.hotelName} in ${hotel.ort}, ${hotel.land} – ${hotel.preis} €`;
        ul.appendChild(li);
      });

      hotelsList.appendChild(ul);
    } catch (err) {
      const hotelsList = document.getElementById('hotelsList');
      hotelsList.textContent = 'Fehler beim Laden der Hotels.';
      console.error(err);
    }
  }
</script>
</body>
</html>
